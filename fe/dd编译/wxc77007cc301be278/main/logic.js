modDefine("app",function(e,n,o){"use strict";App({onLaunch(){},globalData:{userInfo:null}})});
modDefine("pages/index/index",function(n,l,d){"use strict";globalThis.__extraInfo={path:"pages/index/index",usingComponents:{}};const c=n("/utils/blufi");Page({data:{bluetoothEnabled:!1,scanning:!1,devices:[],connected:!1,connectedDevice:null,deviceWifiStatus:null,storedConfig:null,wifiList:[],selectedWifi:null,wifiPassword:"",configuring:!1,configResult:"",currentView:"scan"},onLoad(){this.blufi=new c,this.blufi.on("onWifiList",e=>{console.log("\u6536\u5230WiFi\u5217\u8868:",e),this.setData({wifiList:e}),wx.hideLoading()}),this.blufi.on("onWifiStatus",e=>{console.log("\u6536\u5230WiFi\u72B6\u6001:",e),this.setData({deviceWifiStatus:e,configuring:!1}),wx.hideLoading(),this.data.configuring&&(e.connected?(this.setData({configResult:"success"}),wx.showToast({title:"\u914D\u7F51\u6210\u529F",icon:"success"})):(this.setData({configResult:"fail"}),wx.showToast({title:"\u914D\u7F51\u5931\u8D25",icon:"none"})))}),this.blufi.on("onStoredConfig",e=>{console.log("\u6536\u5230\u5B58\u50A8\u7684WiFi\u914D\u7F6E:",e),this.setData({storedConfig:e}),wx.hideLoading()}),this.blufi.on("onConfigDeleted",()=>{console.log("\u914D\u7F6E\u5DF2\u5220\u9664\uFF0C\u5237\u65B0\u5217\u8868"),setTimeout(()=>{this.getStoredConfig()},500)}),this.blufi.on("onError",e=>{console.error("BluFi\u9519\u8BEF:",e),wx.hideLoading(),wx.showToast({title:"\u64CD\u4F5C\u5931\u8D25",icon:"none"})}),this.blufi.on("onDisconnected",()=>{console.log("\u84DD\u7259\u8FDE\u63A5\u5DF2\u65AD\u5F00"),this.data.connected&&(wx.showToast({title:"\u84DD\u7259\u5DF2\u65AD\u5F00",icon:"none",duration:2e3}),this.setData({connected:!1,connectedDevice:null,deviceWifiStatus:null,wifiList:[],selectedWifi:null,wifiPassword:"",configResult:null,currentView:"scan"}),setTimeout(()=>{this.startScan()},1e3))}),this.checkBluetoothStatus()},checkBluetoothStatus(){wx.openBluetoothAdapter({success:()=>{console.log("\u84DD\u7259\u9002\u914D\u5668\u5DF2\u6253\u5F00"),this.setData({bluetoothEnabled:!0}),this.startScan()},fail:e=>{console.error("\u6253\u5F00\u84DD\u7259\u9002\u914D\u5668\u5931\u8D25:",e),wx.showModal({title:"\u63D0\u793A",content:"\u8BF7\u5148\u6253\u5F00\u624B\u673A\u84DD\u7259",confirmText:"\u53BB\u8BBE\u7F6E",success:t=>{t.confirm&&wx.openSetting()}})}})},openBluetooth(){this.checkBluetoothStatus()},startScan(){this.data.scanning||(this.setData({scanning:!0,devices:[]}),wx.showLoading({title:"\u626B\u63CF\u4E2D..."}),wx.startBluetoothDevicesDiscovery({allowDuplicatesKey:!1,success:()=>{console.log("\u5F00\u59CB\u626B\u63CF\u84DD\u7259\u8BBE\u5907"),wx.onBluetoothDeviceFound(e=>{e.devices.forEach(t=>{const i=t.name||t.localName;if(i&&i.toUpperCase().startsWith("ESP32")){const s=this.data.devices;s.findIndex(a=>a.deviceId===t.deviceId)===-1&&(t.name=i,s.push(t),this.setData({devices:s}),console.log("\u53D1\u73B0ESP32\u8BBE\u5907:",i,t.deviceId))}})}),setTimeout(()=>{this.stopScan()},5e3)},fail:e=>{console.error("\u626B\u63CF\u5931\u8D25:",e),wx.hideLoading(),wx.showToast({title:"\u626B\u63CF\u5931\u8D25",icon:"none"}),this.setData({scanning:!1})}}))},stopScan(){wx.stopBluetoothDevicesDiscovery(),wx.hideLoading(),this.setData({scanning:!1}),this.data.devices.length===0&&wx.showToast({title:"\u672A\u53D1\u73B0\u8BBE\u5907",icon:"none"})},rescan(){this.startScan()},connectDevice(e){const t=e.currentTarget.dataset.device;wx.showLoading({title:"\u8FDE\u63A5\u4E2D..."}),this.blufi.connect(t.deviceId).then(()=>{console.log("BluFi\u8FDE\u63A5\u6210\u529F:",t.name),this.setData({connected:!0,connectedDevice:t,currentView:"status"}),wx.hideLoading(),wx.showToast({title:"\u8FDE\u63A5\u6210\u529F",icon:"success"}),this.refreshDeviceStatus()}).catch(i=>{console.error("\u8FDE\u63A5\u5931\u8D25:",i),wx.hideLoading(),wx.showToast({title:"\u8FDE\u63A5\u5931\u8D25",icon:"none"})})},disconnect(){this.data.connectedDevice&&this.blufi.disconnect().then(()=>{this.setData({connected:!1,connectedDevice:null,deviceWifiStatus:null,wifiList:[],currentView:"scan"}),wx.showToast({title:"\u5DF2\u65AD\u5F00\u8FDE\u63A5",icon:"success"})}).catch(e=>{console.error("\u65AD\u5F00\u8FDE\u63A5\u5931\u8D25:",e)})},refreshDeviceStatus(){wx.showLoading({title:"\u83B7\u53D6\u72B6\u6001..."}),Promise.all([this.blufi.requestWifiStatus(),this.blufi.requestStoredConfig()]).catch(e=>{console.error("\u83B7\u53D6\u72B6\u6001\u5931\u8D25:",e),wx.hideLoading()})},getStoredConfig(){wx.showLoading({title:"\u83B7\u53D6\u914D\u7F6E..."}),this.blufi.requestStoredConfig().catch(e=>{console.error("\u83B7\u53D6\u914D\u7F6E\u5931\u8D25:",e),wx.hideLoading()})},deleteStoredConfig(e){const t=e.currentTarget.dataset.index,i=e.currentTarget.dataset.ssid;wx.showModal({title:"\u786E\u8BA4",content:`\u786E\u5B9A\u8981\u5220\u9664\u914D\u7F6E"${i}"\u5417\uFF1F`,success:s=>{s.confirm&&(wx.showLoading({title:"\u5220\u9664\u4E2D..."}),this.blufi.deleteStoredConfig(t).catch(o=>{console.error("\u5220\u9664\u5931\u8D25:",o),wx.hideLoading()}))}})},connectWithStoredConfig(e){const t=e.currentTarget.dataset.config;wx.showModal({title:"\u786E\u8BA4",content:`\u4F7F\u7528\u914D\u7F6E"${t.ssid}"\u8FDE\u63A5WiFi\uFF1F`,success:i=>{i.confirm&&(this.setData({configuring:!0,configResult:""}),wx.showLoading({title:"\u8FDE\u63A5\u4E2D..."}),this.blufi.sendWifiConfig(t.ssid,t.password).then(()=>{setTimeout(()=>{this.refreshDeviceStatus()},3e3)}).catch(s=>{console.error("\u8FDE\u63A5\u5931\u8D25:",s),this.setData({configuring:!1}),wx.hideLoading()}))}})},scanWifi(){wx.showLoading({title:"\u626B\u63CFWiFi..."}),this.blufi.requestWifiList().catch(e=>{console.error("\u626B\u63CF\u5931\u8D25:",e),wx.hideLoading()})},selectWifi(e){const t=e.currentTarget.dataset.wifi;this.setData({selectedWifi:t,wifiPassword:""})},onPasswordInput(e){this.setData({wifiPassword:e.detail.value})},configWifi(){if(!this.data.selectedWifi){wx.showToast({title:"\u8BF7\u9009\u62E9WiFi",icon:"none"});return}if(this.data.selectedWifi.secure&&!this.data.wifiPassword){wx.showToast({title:"\u8BF7\u8F93\u5165\u5BC6\u7801",icon:"none"});return}this.setData({configuring:!0,configResult:""}),wx.showLoading({title:"\u914D\u7F6E\u4E2D..."}),this.blufi.sendWifiConfig(this.data.selectedWifi.ssid,this.data.wifiPassword).then(()=>{console.log("WiFi\u914D\u7F6E\u5DF2\u53D1\u9001"),setTimeout(()=>{this.refreshDeviceStatus()},3e3)}).catch(e=>{console.error("\u914D\u7F6E\u5931\u8D25:",e),this.setData({configuring:!1}),wx.hideLoading(),wx.showToast({title:"\u914D\u7F6E\u5931\u8D25",icon:"none"})})},disconnectDeviceWifi(){wx.showModal({title:"\u786E\u8BA4",content:"\u786E\u5B9A\u8981\u65AD\u5F00\u8BBE\u5907\u7684WiFi\u8FDE\u63A5\u5417\uFF1F",success:e=>{e.confirm&&(wx.showLoading({title:"\u65AD\u5F00\u4E2D..."}),this.blufi.disconnectWifi().then(()=>{setTimeout(()=>{this.refreshDeviceStatus()},1e3)}).catch(t=>{console.error("\u65AD\u5F00\u5931\u8D25:",t),wx.hideLoading()}))}})},switchView(e){const t=e.currentTarget.dataset.view;this.setData({currentView:t}),t==="scan"&&this.startScan()},onUnload(){console.log("\u9875\u9762\u5378\u8F7D\uFF0C\u6E05\u7406\u84DD\u7259\u8FDE\u63A5"),this.blufi&&this.data.connected&&this.blufi.disconnect().catch(e=>{console.error("\u65AD\u5F00\u8FDE\u63A5\u5931\u8D25:",e)}),wx.closeBluetoothAdapter({success:()=>{console.log("\u84DD\u7259\u9002\u914D\u5668\u5DF2\u5173\u95ED")}})}})});
modDefine("/utils/blufi",function(F,h,u){"use strict";const f="0000FFFF-0000-1000-8000-00805F9B34FB",T="0000FF01-0000-1000-8000-00805F9B34FB",g="0000FF02-0000-1000-8000-00805F9B34FB";class I{constructor(){this.deviceId=null,this.serviceId=f,this.writeCharId=T,this.notifyCharId=g,this.sequence=0,this.receiveBuffer=[],this.callbacks={},this.fragmentBuffer=null,this.fragmentExpectedLength=0}connect(e){return new Promise((s,t)=>{this.deviceId=e,this.sequence=0,this.receiveBuffer=[],this.fragmentBuffer=null,this.fragmentExpectedLength=0,console.log("\u2713 \u5E8F\u5217\u53F7\u5DF2\u91CD\u7F6E\u4E3A0"),wx.onBLEConnectionStateChange(n=>{console.log("\u84DD\u7259\u8FDE\u63A5\u72B6\u6001\u53D8\u5316:",n),n.deviceId===this.deviceId&&(n.connected||(console.log("\u26A0\uFE0F \u84DD\u7259\u8FDE\u63A5\u5DF2\u65AD\u5F00"),this.callbacks.onDisconnected&&this.callbacks.onDisconnected()))}),wx.createBLEConnection({deviceId:e,success:()=>{console.log("BLE\u8FDE\u63A5\u6210\u529F"),wx.setBLEMTU({deviceId:e,mtu:512,success:n=>{console.log("\u2713 MTU\u5DF2\u8BBE\u7F6E\u4E3A:",n.mtu)},fail:n=>{console.log("MTU\u8BBE\u7F6E\u5931\u8D25\uFF08iOS\u4E0D\u652F\u6301\uFF09:",n.errMsg)}}),setTimeout(()=>{this.discoverServices().then(s).catch(t)},1e3)},fail:t})})}discoverServices(){return new Promise((e,s)=>{wx.getBLEDeviceServices({deviceId:this.deviceId,success:t=>{console.log("\u83B7\u53D6\u5230\u670D\u52A1:",t.services);const n=t.services.find(i=>i.uuid.toUpperCase().includes("FFFF"));n?(this.serviceId=n.uuid,this.discoverCharacteristics().then(e).catch(s)):s(new Error("\u672A\u627E\u5230BluFi\u670D\u52A1"))},fail:s})})}discoverCharacteristics(){return new Promise((e,s)=>{wx.getBLEDeviceCharacteristics({deviceId:this.deviceId,serviceId:this.serviceId,success:t=>{console.log("\u83B7\u53D6\u5230\u7279\u5F81\u503C:",t.characteristics),t.characteristics.forEach(n=>{const i=n.uuid.toUpperCase();i.includes("FF01")?this.writeCharId=n.uuid:i.includes("FF02")&&(this.notifyCharId=n.uuid)}),this.enableNotify().then(e).catch(s)},fail:s})})}enableNotify(){return new Promise((e,s)=>{wx.onBLECharacteristicValueChange(t=>{this.handleNotify(t.value)}),wx.notifyBLECharacteristicValueChange({deviceId:this.deviceId,serviceId:this.serviceId,characteristicId:this.notifyCharId,state:!0,success:()=>{console.log("\u901A\u77E5\u5DF2\u542F\u7528"),console.log("\u26A0\uFE0F \u52A0\u5BC6\u5DF2\u7981\u7528\uFF08\u8C03\u8BD5\u6A21\u5F0F\uFF09"),setTimeout(()=>{console.log("\u2713 BluFi\u8FDE\u63A5\u5B8C\u5168\u5EFA\u7ACB\uFF0C\u53EF\u4EE5\u5F00\u59CB\u901A\u4FE1"),e()},500)},fail:s})})}handleNotify(e){const s=new Uint8Array(e);if(console.log(">>> \u6536\u5230\u901A\u77E5\uFF0C\u957F\u5EA6:",s.length,"\u6570\u636E:",Array.from(s).slice(0,20)),this.fragmentBuffer){console.log(">>> \u62FC\u63A5\u5206\u5305\u6570\u636E\uFF0C\u539F\u957F\u5EA6:",this.fragmentBuffer.length,"\u65B0\u6570\u636E:",s.length);const n=new Uint8Array(this.fragmentBuffer.length+s.length);if(n.set(this.fragmentBuffer),n.set(s,this.fragmentBuffer.length),this.fragmentBuffer=n,console.log(">>> \u5F53\u524D\u7F13\u51B2\u533A\u957F\u5EA6:",this.fragmentBuffer.length,"\u671F\u671B\u957F\u5EA6:",this.fragmentExpectedLength),this.fragmentBuffer.length>=this.fragmentExpectedLength){console.log("\u2713 \u5206\u5305\u63A5\u6536\u5B8C\u6210\uFF0C\u5F00\u59CB\u89E3\u6790");const i=this.parseFrame(this.fragmentBuffer);this.fragmentBuffer=null,this.fragmentExpectedLength=0,i&&this.handleFrame(i)}else console.log(">>> \u7EE7\u7EED\u7B49\u5F85\u5206\u5305\uFF0C\u8FD8\u9700\u8981:",this.fragmentExpectedLength-this.fragmentBuffer.length,"\u5B57\u8282");return}const t=this.parseFrame(s);t?this.handleFrame(t):this.fragmentBuffer||console.warn("\u5E27\u89E3\u6790\u5931\u8D25\u4E14\u672A\u542F\u52A8\u5206\u5305\u7F13\u51B2")}parseFrame(e){if(e.length<4)return null;const s=e[0]&3,t=e[0]>>2&63,n=e[1],i=e[2],o=e[3];console.log("\u89E3\u6790\u5E27:",{type:s,subtype:t,fc:n,sequence:i,dataLen:o,totalLen:e.length});const c=4+o+(n&2?2:0);if(e.length<c)return console.warn("\u5E27\u6570\u636E\u4E0D\u5B8C\u6574\uFF0C\u9700\u8981:",c,"\u5F53\u524D:",e.length),this.fragmentBuffer=new Uint8Array(e),this.fragmentExpectedLength=c,console.log("\u7B49\u5F85\u540E\u7EED\u5206\u5305..."),null;let r=e.slice(4,4+o);return console.log("Payload\u539F\u59CB\u6570\u636E\uFF08\u524D20\u5B57\u8282\uFF09:",Array.from(r.slice(0,20))),{type:s,subtype:t,fc:n,sequence:i,dataLen:o,payload:r}}handleFrame(e){if(console.log("\u5904\u7406\u5E27:",e),e.type===1)switch(e.subtype){case 17:this.handleWifiList(e.payload);break;case 15:this.handleWifiStatus(e.payload);break;case 19:this.handleCustomData(e.payload);break;case 18:this.handleError(e.payload);break}}handleWifiList(e){console.log("=== \u5F00\u59CB\u89E3\u6790WiFi\u5217\u8868 ==="),console.log("Payload\u957F\u5EA6:",e.length);const s=[];let t=0;for(;t<e.length;){if(t+2>e.length){console.warn("\u6570\u636E\u4E0D\u5B8C\u6574");break}console.log(`
--- WiFi #${s.length+1} ---`),console.log(`\u5F53\u524Doffset=${t}`);const n=e[t++],i=e[t++],o=n>0?n-1:0;if(console.log(`\u539F\u59CB\u957F\u5EA6=${n}, \u5B9E\u9645SSID\u957F\u5EA6=${o}, RSSI=${i}`),console.log(`\u5C06\u8BFB\u53D6 [${t}, ${t+o})`),o===0||o>32||t+o>e.length){console.warn("SSID\u957F\u5EA6\u5F02\u5E38");break}const c=e.slice(t,t+o);t+=o;const r=i>127?i-256:-i;let l="";for(let a=0;a<c.length;a++)l+=String.fromCharCode(c[a]);console.log(`\u2713 SSID: "${l}", RSSI: ${r}dBm, \u65B0offset=${t}`),s.push({ssid:l,rssi:r,secure:!0})}console.log(`
=== WiFi\u5217\u8868\u89E3\u6790\u5B8C\u6210 ===`),console.log("\u5171\u89E3\u6790\u5230",s.length,"\u4E2AWiFi"),this.callbacks.onWifiList&&this.callbacks.onWifiList(s)}handleWifiStatus(e){if(console.log("=== \u6536\u5230WiFi\u72B6\u6001\u62A5\u544A ==="),console.log("Payload\u957F\u5EA6:",e.length),console.log("Payload\u6570\u636E:",Array.from(e)),e.length<3){console.warn("WiFi\u72B6\u6001\u6570\u636E\u4E0D\u5B8C\u6574");return}const s=e[0],t=e[1],n=e[2],i={opmode:s,connected:t===0,sta_conn_state:t,softap_conn_num:n,ssid:"",password:"",bssid:""};let o=3;for(;o<e.length;){const c=e[o++],r=e[o++];if(console.log(`  \u989D\u5916\u4FE1\u606F - type: ${c}, len: ${r}, offset: ${o}`),o+r>e.length){console.warn("\u989D\u5916\u4FE1\u606F\u957F\u5EA6\u8D85\u51FA\u8303\u56F4");break}const l=e.slice(o,o+r);switch(o+=r,c){case 1:i.bssid=Array.from(l).map(a=>a.toString(16).padStart(2,"0")).join(":"),console.log("  \u89E3\u6790\u5230BSSID:",i.bssid);break;case 2:i.ssid=this.bytesToString(l),console.log("  \u89E3\u6790\u5230SSID:",i.ssid);break;case 3:i.password=this.bytesToString(l),console.log("  \u89E3\u6790\u5230Password");break;case 4:console.log("  SoftAP SSID (\u5FFD\u7565)");break;case 5:console.log("  SoftAP Password (\u5FFD\u7565)");break;default:console.warn("  \u672A\u77E5\u7684\u989D\u5916\u4FE1\u606F\u7C7B\u578B:",c);break}}console.log("\u89E3\u6790\u540E\u7684\u72B6\u6001:",i),this.callbacks.onWifiStatus&&this.callbacks.onWifiStatus(i)}handleError(e){const s=e[0],n={0:"\u5E8F\u5217\u53F7\u9519\u8BEF",1:"\u6821\u9A8C\u548C\u9519\u8BEF",2:"\u89E3\u5BC6\u9519\u8BEF",3:"\u52A0\u5BC6\u9519\u8BEF",4:"\u521D\u59CB\u5316\u5B89\u5168\u9519\u8BEF",5:"DH\u5185\u5B58\u5206\u914D\u9519\u8BEF",6:"DH\u53C2\u6570\u9519\u8BEF",7:"\u8BFB\u53D6\u53C2\u6570\u9519\u8BEF",8:"\u751F\u6210\u516C\u94A5\u9519\u8BEF"}[s]||`\u672A\u77E5\u9519\u8BEF(${s})`;if(console.error("BluFi\u9519\u8BEF:",n),s===0){console.warn("\u26A0\uFE0F \u68C0\u6D4B\u5230\u5E8F\u5217\u53F7\u9519\u8BEF\uFF0C\u91CD\u7F6E\u5E8F\u5217\u53F7\u4E3A0"),this.sequence=0;return}this.callbacks.onError&&this.callbacks.onError(s)}handleCustomData(e){if(console.log("=== \u6536\u5230\u81EA\u5B9A\u4E49\u6570\u636E ==="),console.log("Payload\u957F\u5EA6:",e.length),e.length<2){console.warn("\u81EA\u5B9A\u4E49\u6570\u636E\u592A\u77ED");return}const s=e[0],t=e[1];if(s===1)if(t===0&&e.length>2){const n=e[2];console.log("\u5B58\u50A8\u7684WiFi\u914D\u7F6E\u6570\u91CF:",n);const i=[];let o=3;for(let c=0;c<n&&o<e.length;c++){const r=e[o++];if(o+r>e.length)break;const l=e.slice(o,o+r);o+=r;const a=this.bytesToString(l);if(o>=e.length)break;const _=e[o++];if(o+_>e.length)break;const B=e.slice(o,o+_);o+=_;const d=this.bytesToString(B);i.push({index:c,ssid:a,password:d}),console.log(`  [${c}] ${a}`)}console.log("\u89E3\u6790\u5B8C\u6210\uFF0C\u5171",i.length,"\u4E2A\u914D\u7F6E"),this.callbacks.onStoredConfig&&this.callbacks.onStoredConfig({exists:i.length>0,configs:i})}else console.log("\u8BBE\u5907\u672A\u5B58\u50A8WiFi\u914D\u7F6E"),this.callbacks.onStoredConfig&&this.callbacks.onStoredConfig({exists:!1,configs:[]});else s===2&&(t===0?(console.log("\u2713 \u914D\u7F6E\u5220\u9664\u6210\u529F"),this.callbacks.onConfigDeleted&&this.callbacks.onConfigDeleted()):console.error("\u2717 \u914D\u7F6E\u5220\u9664\u5931\u8D25"))}buildFrame(e,s,t=[]){let n=0,i=t;const o=4+i.length,c=new Uint8Array(o);return c[0]=s<<2|e,c[1]=n,c[2]=this.sequence,c[3]=i.length,i.length>0&&c.set(i,4),this.sequence++,c.buffer}sendData(e){return new Promise((s,t)=>{console.log("\u53D1\u9001\u6570\u636E\u5230\u8BBE\u5907:",{deviceId:this.deviceId,serviceId:this.serviceId,characteristicId:this.writeCharId,dataLength:e.byteLength}),wx.writeBLECharacteristicValue({deviceId:this.deviceId,serviceId:this.serviceId,characteristicId:this.writeCharId,value:e,success:n=>{console.log("\u6570\u636E\u53D1\u9001\u6210\u529F:",n),s(n)},fail:n=>{console.error("\u6570\u636E\u53D1\u9001\u5931\u8D25:",n),t(n)}})})}requestWifiList(){console.log("=== \u5F00\u59CB\u8BF7\u6C42WiFi\u5217\u8868 ===");const e=this.buildFrame(0,9),s=Array.from(new Uint8Array(e));return console.log("\u53D1\u9001\u5E27:",s),console.log("\u5E27\u89E3\u6790: type="+(s[0]&3)+", subtype="+(s[0]>>2&63)+", fc="+s[1]+", seq="+s[2]+", len="+s[3]),this.sendData(e)}requestWifiStatus(){console.log("=== \u8BF7\u6C42WiFi\u72B6\u6001 ===");const e=this.buildFrame(0,5);return this.sendData(e)}disconnectWifi(){console.log("=== \u8BF7\u6C42\u65AD\u5F00WiFi ===");const e=this.buildFrame(0,4);return this.sendData(e)}requestStoredConfig(){console.log("=== \u8BF7\u6C42\u5B58\u50A8\u7684WiFi\u914D\u7F6E ===");const e=[1],s=this.buildFrame(1,19,e);return this.sendData(s)}deleteStoredConfig(e){console.log("=== \u8BF7\u6C42\u5220\u9664WiFi\u914D\u7F6E\uFF0C\u7D22\u5F15:",e,"===");const s=[2,e],t=this.buildFrame(1,19,s);return this.sendData(t)}sendWifiConfig(e,s){return new Promise(async(t,n)=>{try{const i=this.stringToBytes(e),o=this.buildFrame(1,2,i);if(await this.sendData(o),await this.delay(100),s){const r=this.stringToBytes(s),l=this.buildFrame(1,3,r);await this.sendData(l),await this.delay(100)}const c=this.buildFrame(0,3);await this.sendData(c),t()}catch(i){n(i)}})}stringToBytes(e){const s=[];for(let t=0;t<e.length;t++)s.push(e.charCodeAt(t));return s}bytesToString(e){let s="";for(let t=0;t<e.length;t++)s+=String.fromCharCode(e[t]);return s}delay(e){return new Promise(s=>setTimeout(s,e))}on(e,s){this.callbacks[e]=s}disconnect(){return new Promise((e,s)=>{this.deviceId?wx.closeBLEConnection({deviceId:this.deviceId,success:()=>{this.deviceId=null,this.sequence=0,this.receiveBuffer=[],this.fragmentBuffer=null,this.fragmentExpectedLength=0,console.log("\u2713 \u8FDE\u63A5\u5DF2\u65AD\u5F00\uFF0C\u72B6\u6001\u5DF2\u91CD\u7F6E"),e()},fail:s}):e()})}}h.exports=I});
